<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>CCAS Dashboard â€“ Sensor List</title>

  <!-- Unified stylesheet -->
  <link rel="stylesheet" href="css/style.css">

  <!-- Minimal fallback if style.css fails (no header/nav styles) -->
  <style>
  /* â”€â”€â”€ Root palette & simple layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  :root{
    --brand:#004b8d;
    --text:#ffffff;
    --radius:6px;
    --card-bg:#e6f1ff;
  }

  body{
    margin:0;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    display:flex;flex-direction:column;min-height:100vh;
  }

  main{flex:1;padding:1rem;max-width:900px;margin:auto;box-sizing:border-box;}

  /* â”€â”€â”€ Sensor table â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #sensor-table{width:100%;border-collapse:collapse;font-size:0.95rem;}
  #sensor-table th,#sensor-table td{padding:.45rem .8rem;border-bottom:1px solid #d0d7de;white-space:nowrap;}
  #sensor-table thead th{background:var(--card-bg);font-weight:600;}
  #sensor-table tbody tr:nth-child(even){background:#f8fbff;}

  /* numeric columns aligned right */
  #sensor-table th[data-key="aqhi"],
  #sensor-table td:nth-child(2){
    text-align:right;font-variant-numeric:tabular-nums;
  }
    /* Let â€œLast Seenâ€ header wrap to two lines */
    #sensor-table th[data-key="timestamp"]{
      white-space:normal;
    }

    /* slightly smaller header text to fit two-line labels */
    #sensor-table thead th{font-size:0.8rem;line-height:1.25;}

  /* â™¿ Reduced motion (site-wide override) */
  @media (prefers-reduced-motion: reduce){
    html { scroll-behavior: auto; }                /* disable smooth scroll from style.css */
    .nav-button, .hamburger, .card { transition: none; }
    .nav-button:hover,
    .nav-button:focus,
    .nav-button:focus-visible { transform: none; } /* no lift on focus/hover */
  }
  </style>

</head>

<body>
  <a class="skip-link" href="#main">Skip to content</a>

  <header class="site-header">
    <a href="index.html" class="logo">CCAS Dashboard</a>

    <button class="hamburger" aria-controls="site-nav" aria-expanded="false">
      <span class="visually-hidden">Menu</span>â˜°
    </button>

    <nav id="site-nav" class="nav">
      <a class="nav-button" href="index.html">Home</a>
      <a class="nav-button" href="map.html">Map</a>
      <a class="nav-button" href="details.html">Graphs</a>
      <a class="nav-button" href="list.html" aria-current="page">Sensor&nbsp;List</a>
      <a class="nav-button" href="info.html">Info</a>
    </nav>
  </header>

  <main id="main">
    <!-- desktop/table view -->
    <div class="table-scale-wrap">
      <table id="sensor-table" class="scale-target">
        <thead>
          <tr>
            <th data-key="name">Name â–²</th>
            <th data-key="aqhi">AQHI</th>
            <th data-key="primary">Main&nbsp;Contributor</th>
            <th data-key="timestamp">Last&nbsp;Seen</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  
    <!-- mobile/cards view -->
    <div id="sensor-cards" class="sensor-cards"></div>
  </main>


  <footer id="stamp" class="site-footer">Updating&hellip;</footer>

  <!-- sensor-list logic -->
  <script type="module" src="js/list.js"></script>

  <!-- last-generated time -->
  <script type="module">
    import { getSensorData } from './js/data.js';
    getSensorData()
      .then(({ generated_at }) => {
        document.getElementById('stamp').textContent =
          'Last Updated ' + new Date(generated_at).toLocaleString();
      })
      .catch(() => {
        document.getElementById('stamp').textContent =
          'âš  Unable to fetch latest data';
      });
  </script>

  <!-- hamburger toggle -->
  <script src="js/menu.js" defer></script>
  
  <script>
  (function(){
    const wrap  = document.querySelector('.table-scale-wrap');
    const table = document.getElementById('sensor-table');
    if(!wrap || !table) return;
  
    const scaleTable = () => {
      // measure unscaled
      table.style.transform = 'none';
      wrap.style.height = 'auto';
  
      const naturalW  = table.offsetWidth;
      const naturalH  = table.offsetHeight;
      const available = wrap.clientWidth || window.innerWidth;
  
      let scale = naturalW ? Math.min(1, available / naturalW) : 1;
      // snap a bit to reduce blur
      scale = Math.round(scale * 200) / 200;
  
      table.style.transform = scale === 1 ? 'none' : `scale(${scale})`;
      wrap.style.height = (naturalH * scale) + 'px';
    };
  
    // expose for manual calls
    window.fitSensorTable = scaleTable;
  
    // container resizes
    new ResizeObserver(scaleTable).observe(wrap);
  
    // fonts / load / orientation
    if (document.fonts && document.fonts.ready) document.fonts.ready.then(scaleTable);
    window.addEventListener('orientationchange', scaleTable, {passive:true});
    window.addEventListener('load', scaleTable);
  
    // content changes (rows added + expand/collapse)
    const tbody = table.tBodies && table.tBodies[0];
    if (tbody) {
      new MutationObserver(scaleTable).observe(tbody, {
        childList: true,
        subtree: true,
        attributes: true,       // ğŸ‘ˆ catch display toggles
        attributeFilter: ['style']
      });
    }
  
    scaleTable();
  })();
  </script>

</body>
</html>
